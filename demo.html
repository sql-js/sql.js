<html>
<head>
  <title>
    sql.js
  </title>
  <style>
  #output table {
    border-collapse: collapse;
    border: 2px black solid;
  }

  #output th,td {
    border:1px black solid;
    padding:10px;
  }
  </style>
  <script src="sql.js"></script>
  <script src="http://d3js.org/d3.v2.min.js"></script>
  <script>
    // Connect to the HTML element we 'print' to
    function print(text) {
      var element = document.getElementById('error');
      element.innerHTML = text.replace(/\n/g, '<br>');
    }

    // Open a database
    var db = SQL.open();

    // Run a command in the database
    function execute(commands) {
      try {
        // Select the <table> node
        var table = d3.select("#output").select("table");

        // Remove the contents (rows) of the table
        table.selectAll("tr").remove();

        // Clear any error messages printed earlier
        d3.select("#error").text("");

        var data = db.exec(commands.replace(/\n/g, '; '));

        // Detach the header from the array
        var header = data.splice(0,1);

        // Print the header
        table.selectAll("tr#h")// #h differentiates this row from data rows below
          .data(header)
          .enter()
          .append("tr")
          .attr("id", "h")// #h differentiates this row from data rows below
          .selectAll("td")
          .data(function(d,i){return d;})
          .enter()
          .append("th")
          .text(function(d,i){return d;})
          ;

          // Print the rest of the data
          table.selectAll("tr#d")// #d differentiates these rows from header row above
            .data(data)
            .enter()
            .append("tr")
            .attr("id", "d")// #d differentiates these rows from header row above
            .selectAll("td")
            .data(function(d,i){return d;})
            .enter()
            .append("td")
            .text(function(d,i){return d;})
            ;
      } catch(e) {
        print(e);
      }
    }
  </script>
</head>
<body>
  <p>
    This is <a href="https://github.com/gurjeet/sql.js">sql.js</a>: <a href="http://www.sqlite.org/">SQLite</a> compiled from C to JavaScript using <a href="http://emscripten.org">Emscripten</a>. View this page's source to see how easy it is to use it!
  </p>
  <p>
    <ul>
      <li>This is <b>not</b> a fully optimized build (optimized builds break both <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=733208">Firefox</a> and <a href="http://code.google.com/p/v8/issues/detail?id=1986">Chrome</a>).</li>
    </ul>
  </p>
  <hr>
  <form onsubmit="execute(commands.value); return false">
    <b>Enter some SQL</b>:
    <br>
    <textarea rows="10" cols="80" id="commands">CREATE TABLE my_table(key INTEGER, value INTEGER, text VARCHAR(100));

INSERT INTO my_table VALUES(1, 25, 'the first item');
INSERT INTO my_table VALUES(2, 987, 'the second item');

SELECT key, text FROM my_table WHERE value == 987;
</textarea>
    <br>
    <input type="submit" value="execute">
  </form>
  <hr>
  <div id="error" style="font-family: Courier New,Courier,monospace;"></div>
  <div id="output" style="font-family: Courier New,Courier,monospace;">
    <table></table>
  </div>

<a href="https://github.com/gurjeet/sql.js"><img style="position: absolute; top: 0; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_red_aa0000.png" alt="Fork me on GitHub"></a>

</body>
</html>

