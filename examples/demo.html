<meta charset="utf8" />
<html>
<script src='../dist/sql-wasm-debug.js'></script>
<script>
  const log = (text) => document.getElementById('output').insertAdjacentHTML('beforeend', `${text}<br />`);
  const config = {
      locateFile: (filename, prefix) => {
        return `../dist/${filename}`;
      }
    };
  // The `initSqlJs` function is globally provided by all of the main dist files if loaded in the browser.
  // We must specify this locateFile function if we are loading a wasm file from anywhere other than the current html page's folder.
  async function main() {
    
    const Database = await sqleet(config);
    console.log('Database', Database)

    //Create the database
    const db = new Database();
    console.log('db', db)

    await db.mount();
    console.log('Database mounted');

    db.run('PRAGMA `encoding`="UTF-8";');
    db.run('PRAGMA `key`="supersecurepassword";');

    // beforeunload event catch when the page is about to change
    window.addEventListener("beforeunload", async (event) => {
      await db.saveChanges();
      return true;
    });
    
    // Run a query without reading the results
    db.run("CREATE TABLE IF NOT EXISTS test (col1, col2);");
    // Insert two random rows
    db.run("INSERT INTO test VALUES (?,?), (?,?)", [Math.random(), Math.random(), Math.random(), Math.random()]);
    //db.run(`INSERT INTO test VALUES (${Math.random()},${Math.random()}), (${Math.random()},${Math.random()})`);

    // Prepare a statement
    var stmt = db.prepare("SELECT * FROM test WHERE col1");
    console.log(stmt)
    log(stmt.getAsObject());
    console.log(stmt)

    // Results will increment as the page gets reloaded
    while (stmt.step()) {
      var row = stmt.getAsObject();
      log('Found a row: ' + JSON.stringify(row));
    }
  };

  main();
</script>

<body>
  <p>Javascript output:</p>
  <p id="output"></p>
</body>

</html>